# OrderBookMonitor

Огляд
-----
`OrderBookMonitor` — консольна утиліта для моніторингу та візуалізації глибини ордербуку (order book) і стрімінгових даних від біржі (MEXC). Програма підписується на стрім даних, декодує protobuf-повідомлення, підтримує правила сигналів (alert rules) і виводить консольний рендер ордербуку.

Ключові архітектурні рішення
--------------------------------
- Розділення відповідальностей (Separation of Concerns): мережевий код, декодер protobuf, обробник ордербуку, логіка сигналів і UI розділені між відповідними каталогами (`Networking/`, `Decoding/`, `OrderBook/`, `Alerts/`, `UI/`). Це полегшує тестування і розширення.
- Легка вага і мінімальні залежності: проект орієнтований на швидку роботу в консолі і на серверних середовищах, тому відсутні важкі графічні бібліотеки.
- Асинхронна обробка повідомлень: WebSocket-клієнт (`Networking/MexcWebSocketClient.cs`) та декодер працюють асинхронно, щоб підтримувати низьку затримку при високому трафіку.
- Протокол обміну: для ефективної передачі використовується protobuf (файли в `Proto/`), що забезпечує компактні й швидкі повідомлення; декодування централізовано в `Decoding/MexcProtobufDecoder.cs`.
- Правила сигналів як розширювані стратегії: кожне правило реалізує інтерфейс `ISignalRule` (в `Alerts/`) — додавайте нові правила без зміни рушія сигналів (`SignalEngine.cs`).
- Канали оповіщень (Alert channels): інтерфейс `IAlertChannel` дозволяє додавати SMTP/HTTP/Slack/Telegram канали оповіщень без втручання в логіку генерації сигналів.

Компоненти і їх призначення
---------------------------
- `Networking/MexcWebSocketClient.cs`: підключення до стрімінгового API, підписка на топіки, реконекшн і перепідписки при обриві.
- `Decoding/MexcProtobufDecoder.cs`: перетворює байти protobuf у типізовані об'єкти; тут зосереджена логіка мапінгу і перевірки сумісності версій повідомлень.
- `OrderBook/OrderBookProcessor.cs` та `OrderBook/Models.cs`: агрегування змін глибини, підтримка різних режимів (повна книга або інкрементальні оновлення), обчислення кандидатів для візуалізації.
- `UI/ConsoleOrderBookRenderer.cs`: компактне й читабельне відображення стану книги в консолі, оновлення в реальному часі.
- `Alerts/`: набір правил (наприклад, `LargeWallRule.cs`, `SpreadSpikeRule.cs`) та рушій (`SignalEngine.cs`) для генерації сигналів на основі стану order book.
- `Infrastructure/EnvLoader.cs`: завантаження конфігурації з оточення; дозволяє безпечно тримати секрети та змінні конфігурації поза кодом.
- `Logging/FileLogger.cs`: простий файловий логер для діагностики. Можна підміняти інтерфейс логування для інтеграції з більш просунутими системами.

Потік даних (high-level)
------------------------
1. `MexcWebSocketClient` приймає байтові повідомлення по WebSocket.
2. Повідомлення передається у `MexcProtobufDecoder`, який повертає сильні типи (models).
3. `OrderBookProcessor` застосовує оновлення до локальної моделі order book.
4. `SignalEngine` опитує або отримує події від `OrderBookProcessor` і оцінює правила (`ISignalRule`).
5. При спрацьовуванні правила інстанції `IAlertChannel` (реалізації каналів) відправляють повідомлення.
6. `ConsoleOrderBookRenderer` оновлює консольний інтерфейс для оператора.

Налаштування і запуск
---------------------
- Вимоги: .NET 10 SDK / runtime (проект таргетує `net10.0` — див. конфігурацію в `OrderBookMonitor.csproj`).
- Збірка і запуск локально:

```
dotnet build
dotnet run --project OrderBookMonitor.csproj
```

- Конфігурація: використовуються змінні оточення (через `Infrastructure/EnvLoader.cs`) — наприклад, URL WebSocket, ключі доступу, налаштування логування. Додайте потрібні змінні у середовище перед запуском.

Розширення і підтримка
-----------------------
- Додавання нового правила сигналів: створіть клас, що реалізує `ISignalRule` в `Alerts/`, зареєструйте його у фабриці або інжекції залежностей у `SignalEngine`.
- Додавання каналу оповіщення: реалізуйте `IAlertChannel` і додайте екземпляр у конфігурацію запуску програми.
- Підтримка нових типів повідомлень: додайте .proto файл у `Proto/`, згенеруйте код і реалізуйте мапінг у `Decoding/MexcProtobufDecoder.cs`.

Логи та моніторинг
------------------
- Логи записуються через `Logging/FileLogger.cs`.
